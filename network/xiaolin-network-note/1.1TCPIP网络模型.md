### TCP/IP 网络模型

TCP/IP 网络模型 5层架构

- 为什么要有这样的结构？

进行解耦，每个层负责自己的事情，更具体地事情交给下面层的协议完成，防止协议模型过于复杂，耦合度更低，拓展性更强。

#### 应用层

​	应用层是最上层的协议，一般应用软件都是在应用层实现的，当不同设备的应用需要通信时，就要将数据交给下一层。

​	**也就是说，应用层只需要对用户提供服务，不需要关心数据是怎么传输的。而且，应用层工作在用户态，而传输层及以下协议工作在内核态。**

#### 传输层

​	传输层为应用层提供网络服务，传输层有两个协议：**TCP和UDP**

- TCP
  - 传输控制层协议，TCP相比于UDP多了很多特性：**流量控制，超时重传，拥塞控制，**这些都是为了保证TCP的可靠性。
- UDP
  - 简单地只负责发送数据包，**不保证数据包是否抵达对方，但是实时性更好，传输效率更高。**
- TCP 的 分段传输
  - 应用层传输的数据包可能非常大，如果直接传输就不好控制（比如当需要超时重传时就需要重传整个数据包），所以 **当传输层的数据包大小超过 MSS(TCP最大报文段长度）时，就会将数据包分块，这样的每个分块叫做 TCP Segment(段)。**
- 传输层返回应用层时
  - 当作为接收方时，需要将传输层数据包传给应用层的应用，这个时候需要 **端口** 来确认接收的应用。

#### 网络层

​	**实际上，传输层并不负责实际的数据传输，而是只是作为应用间数据传输的媒介。实际的传输功能同样的交给下一层完成。也就是网络层。**

​	常用的是 **IP 协议，IP 协议会将传输层的报文作为数据部分，再加上 IP 包头组成 IP 报文。**

- IP 的分片
  - 当IP报文超过 MTU 时，**会再次进行分片，得到一个即将发送到网络的IP报文。**
  - ![image-20210715214808051](..\references-figures\image-20210715214808051.png)
- **IP 协议的作用**
  - 区别设备（寻址）
    - 网络层负责将数据从一个设备传输到另一个设备，需要IP协议来区分设备的编号。
    - 用IP地址来给设备进行编号，对于IPv4协议，IP地址32位，分成了4段，每段8位。
      - 只用IP地址可以做到设备区分，但是这样要一个个匹配吗，也太xx了。
      - **所以，IP地址分层两个意义：1. 网络号即网段。2. 主机号，标识同一网段下的不同主机。**
    - 需要配合子网掩码才能计算出 IP 地址的 网络号 和 主机号，在寻址的过程中，先匹配网段再寻找对应的主机。
  - 路由
    - 在两个设备中寻找最优的路径。

#### 数据链路层

​	在不同的网络中，需要一个设备作为中间媒介，常见的是路由器。**路由器可以通过路由表计算出下一个要去的IP地址。**

​	但是，**路由器怎么知道这个IP地址是哪个设备的呢？**

​	所以，需要一个专门来识别 网络中的设备，让数据在一个链路中传输，这就是数据链路层，**为网络层提供链路级别传输的服务。**

​	**每一个设备的网卡都有一个MAC地址，用来唯一标识设备，路由器计算出了下一个目的地的IP地址，再通过ARP协议找到目的地的MAC地址，就知道 这个IP地址是哪个设备的了。**

#### 物理层

​	数据发送到网络时，需要将数据包转换为电信号，在物理介质中传输，也就是物理层的工作。**为数据链路层提供二进制传输服务。**